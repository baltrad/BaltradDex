<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BaltradDex: Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="baltrad_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">BaltradDex
   </div>
   <div id="projectbrief">BALTRAD Data Exchange System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('install.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Installation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section date"><dt>Date</dt><dd>December 2015 </dd></dl>
<dl class="section version"><dt>Version</dt><dd>2.2</dd></dl>
<p><a class="el" href="index.html#main_index">Index</a></p>
<ol type="1">
<li><a class="el" href="#prereq">Prerequisites</a></li>
<li><a class="el" href="#prep">Preparation</a><ol type="a">
<li><a class="el" href="#prep_db">Create database</a></li>
<li><a class="el" href="#prep_tomcat">Configure Tomcat</a><ol type="i">
<li><a class="el" href="#prep_tomcat_keystore">Prepare certificate keystore</a></li>
<li><a class="el" href="#prep_tomcat_connectors">Configure connectors</a></li>
<li><a class="el" href="#prep_tomcat_admin_account">Configure administrative account</a></li>
<li><a class="el" href="#prep_tomcat_logrotate">Add logrotate on the tomcat logs</a></li>
</ol>
</li>
<li><a class="el" href="#prep_app_context">Configure application context</a></li>
</ol>
</li>
<li><a class="el" href="#build_dex">Build &amp; install BaltradDex</a></li>
<li><a class="el" href="#test_dex">Testing</a></li>
</ol>
<dl class="section attention"><dt>Attention</dt><dd><br  />
Baltrad Data Exchange System (BaltradDex) constitutes an integral part of baltrad node software package. As such, it provides full functionality only if installed with node-installer utility. However it is possible to deploy BaltradDex provided that the following BALTRAD software components are installed in the system: </dd>
<dd>
<br  />
<ul>
<li><b>baltrad-db</b> - Baltrad database management system</li>
<li><b>beast</b> - Baltrad message management and data processing interface </li>
</ul>
</dd>
<dd>
<br  />
Please refer to the documentation of the above packages for installation and usage instructions. </dd>
<dd>
<br  />
 Although the above configuration may work, the functionality it provides will be limited and the system operation may be unstable. Therefore it should not be used for operational work. It is strongly recommended to perform full installation procedure using node-installer utility.</dd></dl>
<h1><a class="anchor" id="prereq"></a>
Prerequisites</h1>
<p>BaltradDex depends on the following software packages:</p><ul>
<li><b>Java Development Kit (JDK)</b> - version 1.6.0_20 or later.</li>
<li><b>Apache Tomcat</b> - version 6.0.26 or later. BaltradDex is implemented as Java Web Application. As such, it requires Apache Tomcat JSP and servlet container to run.</li>
<li><b>Apache Ant build tool</b> - version 1.7.1 or later. Build, deployment and other tasks are executed and controlled by Apache Ant build tool.</li>
<li><b>PostgreSQL database server</b> - version 8.4 or later. BaltradDex uses PostgreSQL database server to store its configuration and runtime parameters.</li>
<li><b>HDF Java</b> - HDF5 libraries for Java, version 2.7 or later. HDF Java can be either build from sources or installed as precompiled binaries. For detailed information and download go to: <a href="http://www.hdfgroup.org/hdf-java-html/">http://www.hdfgroup.org/hdf-java-html/</a></li>
</ul>
<dl class="section attention"><dt>Attention</dt><dd><br  />
BaltradDex makes reference to libraries provided by baltrad-db and beast components. Make sure the above software packages are installed on your system and that suitable libraries are available before installing BaltradDex.</dd></dl>
<h1><a class="anchor" id="prep"></a>
Preparation</h1>
<h2><a class="anchor" id="prep_db"></a>
Create database</h2>
<p>Before installing the software, you have to create a dedicated database and user in the PostgreSQL server. It can be achieved using psql client or pgAdmin administrative tool as well.</p>
<p>With psql client, use the following commands:</p>
<div class="fragment"><div class="line">$ su - postgres</div>
<div class="line">$ psql</div>
<div class="line">&gt; CREATE USER baltrad with PASSWORD <span class="stringliteral">&#39;baltrad&#39;</span>;</div>
<div class="line">&gt; CREATE DATABASE baltrad with OWNER baltrad;</div>
</div><!-- fragment --><h2><a class="anchor" id="prep_tomcat"></a>
Configure Tomcat</h2>
<dl class="section note"><dt>Note</dt><dd>Since version 1.7, BaltradDex uses secure communication protocol (HTTPS) for encrypting sensitive data (e.g. passwords, user accounts and node settings). This solution requires opening 2 independent ports for handling standard and secure communication between client (browser) and server (BALTRAD node). The following is a detailed instruction on how to configure your Apache Tomcat servlet container to enable secure communication with SSL. Please refer to <a href="http://tomcat.apache.org/tomcat-4.0-doc/ssl-howto.html">Apache Tomcat documentation</a> for more information about how to configure SSL on Tomcat. \endnote</dd></dl>
<h3><a class="anchor" id="prep_tomcat_keystore"></a>
Prepare certificate keystore</h3>
<p>To create a new keystore from scratch, containing a single self-signed Certificate, execute the following from a terminal command line:</p>
<div class="fragment"><div class="line">$ %JAVA_HOME%/bin/keytool -genkey -alias tomcat -keyalg RSA </div>
<div class="line">                -keystore /path/to/my/keystore</div>
</div><!-- fragment --><p>where <code>JAVA_HOME</code> points at your <code>JDK</code> installation.</p>
<p>After executing this command, you will first be prompted for the keystore password. The default password used by Tomcat is <code>changeit</code> (all lower case), although you can specify a custom password if you like.</p>
<p>Next, you will be prompted for general information about this Certificate, such as company, contact name, and so on. This information will be displayed to users who attempt to access a secure page in your application, so make sure that the information provided here matches what they will expect.</p>
<p>Finally, you will be prompted for the key password, which is the password specifically for this Certificate (as opposed to any other Certificates stored in the same keystore file). You MUST use the same password here as was used for the keystore password itself.</p>
<h3><a class="anchor" id="prep_tomcat_connectors"></a>
Configure connectors</h3>
<p>Application context is configured in a way allowing to automatically switch between secure and standard communication protocols. Such configuration requires to open 2 independent ports for connections between the browser and the server. In order to do this, edit server.xml configuration file located in the following directory:</p>
<div class="fragment"><div class="line">%CATALINA_HOME%/conf/server.xml</div>
</div><!-- fragment --><p>where <code>CATALINA_HOME</code> represents the directory into which you installed Tomcat.</p>
<p>First, configure SSL connector that will handle secure, encrypted connections:</p>
<div class="fragment"><div class="line">&lt;Connector port=<span class="stringliteral">&quot;8443&quot;</span> protocol=<span class="stringliteral">&quot;HTTP/1.1&quot;</span> SSLEnabled=<span class="stringliteral">&quot;true&quot;</span></div>
<div class="line">           maxThreads=<span class="stringliteral">&quot;200&quot;</span> scheme=<span class="stringliteral">&quot;https&quot;</span> secure=<span class="stringliteral">&quot;true&quot;</span></div>
<div class="line">           clientAuth=<span class="stringliteral">&quot;false&quot;</span> sslProtocol=<span class="stringliteral">&quot;TLS&quot;</span> URIEncoding=<span class="stringliteral">&quot;UTF-8&quot;</span></div>
<div class="line">               keystoreFile=<span class="stringliteral">&quot;/path/to/my/keystore/keystore.jks&quot;</span> </div>
<div class="line">               keystorePass=<span class="stringliteral">&quot;s3cret&quot;</span> keystoreAlias=<span class="stringliteral">&quot;tomcat&quot;</span>/&gt;</div>
</div><!-- fragment --><p>The <code>port</code> attribute (default value is 8443) is the TCP/IP port number on which Tomcat will listen for secure connections. You can change this to any port number you wish. Assuming that you are upgrading your baltrad-node installation, you will probably prefer to use the same port number as you have been using for standard, non-secure communication up to now. Make sure that <code>keystoreFile</code> points at your certificate keystore created in the first step, and that <code>keystorePass</code> matches the password set for the keystore. <br  />
</p>
<p>Next, configure the non-SSL connector that will handle standard (non-secure) connections. Please note that the <code>redirectPort</code> attribute must match the port number configured in SSL connector. Also, make sure that different port numbers are configured for standard and SSL connectors.</p>
<div class="fragment"><div class="line">&lt;Connector port=<span class="stringliteral">&quot;8084&quot;</span> protocol=<span class="stringliteral">&quot;HTTP/1.1&quot;</span> connectionTimeout=<span class="stringliteral">&quot;20000&quot;</span></div>
<div class="line">           redirectPort=<span class="stringliteral">&quot;8443&quot;</span> URIEncoding=<span class="stringliteral">&quot;UTF-8&quot;</span> /&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="prep_tomcat_admin_account"></a>
Configure administrative account</h3>
<p>Once Tomcat servlet container is installed, remember to configure administrative account to be used at the deployment stage. Edit <code>tomcat-users.xml</code> file located in <code>TOMCAT_DIR/conf</code> so it looks like the following:</p>
<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&#39;1.0&#39;</span> encoding=<span class="stringliteral">&#39;utf-8&#39;</span>?&gt;</div>
<div class="line">&lt;tomcat-users&gt;</div>
<div class="line">    &lt;role rolename=<span class="stringliteral">&quot;tomcat&quot;</span>/&gt;</div>
<div class="line">    &lt;role rolename=<span class="stringliteral">&quot;manager&quot;</span>/&gt;</div>
<div class="line">    &lt;user password=<span class="stringliteral">&quot;tomcat&quot;</span> roles=<span class="stringliteral">&quot;tomcat&quot;</span> username=<span class="stringliteral">&quot;tomcat&quot;</span>/&gt;</div>
<div class="line">    &lt;user password=<span class="stringliteral">&quot;tomcat&quot;</span> roles=<span class="stringliteral">&quot;role1&quot;</span> username=<span class="stringliteral">&quot;role1&quot;</span>/&gt;</div>
<div class="line">    &lt;user password=<span class="stringliteral">&quot;s3cret&quot;</span> roles=<span class="stringliteral">&quot;manager,admin&quot;</span> username=<span class="stringliteral">&quot;manager&quot;</span>/&gt;</div>
<div class="line">&lt;/tomcat-users&gt;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>At this step it is necessary to restart Tomcat servlet container for the configuration changes to take effect. \endnote</dd></dl>
<h2><a class="anchor" id="prep_tomcat_logrotate"></a>
Add logrotate on the tomcat logs</h2>
<p>The application can produce a lot of debug or informative messages in the log files. These files can in turn become very large so it might be a good idea to add a logrotate rule to keep the log files in check.</p>
<p>Add a file, /etc/logrotate.d/tomcat or similar and add the following information in the configuration file.</p>
<pre class="fragment">/opt/baltrad/third_party/tomcat/logs/catalina.out {  
  copytruncate  
  daily  
  rotate 7  
  compress  
  missingok  
  size 5M  
}
</pre><h2><a class="anchor" id="prep_app_context"></a>
Configure application context</h2>
<p>In order to complete security settings, it is necessary to edit application context definition file:</p>
<div class="fragment"><div class="line">web/WEB-INF/applicationContext.xml</div>
</div><!-- fragment --><p>There is port mapping section located at the top of the file inside <code>&lt;security:http&gt;</code> tag. Enter port number for secure and standard connections matching Tomcat connectors configured in the previous as follows:</p>
<div class="fragment"><div class="line">&lt;security:http <span class="keyword">auto</span>-config=<span class="stringliteral">&quot;true&quot;</span> access-denied-page=<span class="stringliteral">&quot;/login.htm&quot;</span>&gt; </div>
<div class="line">        &lt;security:port-mappings&gt;</div>
<div class="line">            &lt;security:port-mapping http=<span class="stringliteral">&quot;8084&quot;</span> https=<span class="stringliteral">&quot;8443&quot;</span>/&gt;</div>
<div class="line">        &lt;/security:port-mappings&gt; </div>
<div class="line">        ...</div>
<div class="line">&lt;/security:http&gt;        </div>
</div><!-- fragment --><h1><a class="anchor" id="build_dex"></a>
Build &amp; install BaltradDex</h1>
<p>The first step of installation is creating necessary database schema. This is achieved by executing the following build script task:</p>
<div class="fragment"><div class="line">$ cd BaltradDex</div>
<div class="line">$ ant create-full-schema</div>
</div><!-- fragment --><p>Next step is preparing a keystore to be used with application. The keystore is used to authenticate requests during node-to-node communication. In order to do this, edit some properties in <code>etc/dex.properties</code> file:</p>
<ul>
<li><code>node.name</code> - the name of your BALTRAD node, e.g. test.baltrad.eu</li>
<li><code>keystore.directory</code> - the directory where keystore will be created</li>
</ul>
<p>Next, call the following build script task:</p>
<div class="fragment"><div class="line">$ cd BaltradDex</div>
<div class="line">$ ant init-keystore</div>
</div><!-- fragment --><p>To build and deploy BaltradDex application on Tomcat server:</p>
<div class="fragment"><div class="line">$ cd BaltradDex</div>
<div class="line">$ ant deploy</div>
</div><!-- fragment --><dl class="section attention"><dt>Attention</dt><dd><br  />
At this stage it may be necessary to modify appserver.properties file located in BaltradDex/etc folder. Note that user's name and password for Tomcat user have to match your setup in tomcat-users.xml.</dd></dl>
<h1><a class="anchor" id="test_dex"></a>
Testing</h1>
<p>To run unit tests, execute the following ant task:</p>
<div class="fragment"><div class="line">$ cd BaltradDex</div>
<div class="line">$ ant test</div>
</div><!-- fragment --><p>To run integration tests, execute the following ant task:</p>
<div class="fragment"><div class="line">$ cd BaltradDex</div>
<div class="line">$ ant execute-itest</div>
</div><!-- fragment --><dl class="section attention"><dt>Attention</dt><dd><br  />
Integration tests require that baltrad-db and beast software packages are installed in your system. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Mar 27 2024 09:47:05 for BaltradDex by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
